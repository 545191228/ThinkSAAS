<?php defined('IN_TS') or die('Access Denied.');switch($ts){		case "":				$reviewid = intval($_GET['reviewid']);		//$new['apple']->isReview();				$strReview = $db->once_fetch_assoc("select * from ".dbprefix."apple_review where `reviewid`='$reviewid'");		$strReview['user'] = aac('user')->getSimpleUser($strReview['userid']);				//苹果机		$strApple = $db->once_fetch_assoc("select * from ".dbprefix."apple where `appleid`='".$strReview['appleid']."'");		$index = $db->fetch_all_assoc("select * from ".dbprefix."apple_index where `appleid`='".$strReview['appleid']."'");		foreach($index as $key=>$item){			$strApple['model'][] = array(				'virtuename'	=> $new['apple']->getVirtueName($item['virtueid']),				'parameter'	=> $item['parameter'],			);		}				$title = $strReview['title'];		include template('review');		break;			//添加点评	case "add":		$userid = intval($TS_USER['user']['userid']);				if($userid == 0){			header("Location: ".SITE_URL.tsurl('user','login'));			exit;		}				$appleid = intval($_GET['appleid']);				$new['apple']->isApple($appleid);				$title = '添加点评';		include template('review_add');				break;			case "add_do":		$userid = intval($TS_USER['user']['userid']);				if($userid == 0){			header("Location: ".SITE_URL);			exit;		}				$appleid = intval($_POST['appleid']);		$new['apple']->isApple($appleid);				$title = trim($_POST['title']);		$content = trim($_POST['content']);				if($title=='' || $content == ''){			header("Location: ".SITE_URL);			exit;		}				$addtime = time();				$db->query("insert into ".dbprefix."apple_review (`appleid`,`userid`,`title`,`content`,`addtime`) values ('$appleid','$userid','$title','$content','$addtime')");				$reviewid=$db->insert_id();				header("Location: ".SITE_URL.tsurl('apple','review',array('reviewid'=>$reviewid)));				break;	}